{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Lab 4: Sensing Part 1\n",
    "### EECS 16B: Designing Information Devices and Systems II, Spring 2023\n",
    "Updated by Mia Mirkovic (2020)\n",
    "\n",
    "Updated by Rafael Calleja (2021)\n",
    "\n",
    "Updated by Steven Lu, Kaitlyn Chan (2021)\n",
    "\n",
    "Updated by Steven Lu (2022)\n",
    "\n",
    "Updated by Shrey Aeron, Mingyang Wang, and Megan Zeng (2022)\n",
    "\n",
    "Updated by Megan Zeng (2023)\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Table of Contents\n",
    "\n",
    "* [Part 0: Introduction](#part0)\n",
    "* [Part 1: Mic Board Circuitry](#part1)\n",
    "* [Part 2: *Bass*ic Filter](#part2)\n",
    "* [Part 3: Checkoff](#checkoff)\n",
    "* [Part 4: Midterm Lab Report Questions](#part4)\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<a id='part0'></a>\n",
    "# <span style=\"color:navy\">Part 0: Introduction</span>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "In the previous lab, you built S1XT33N's legs: the motor controller circuits that enable it to move around and the encoder circuits to sense how far and fast S1XT33N has moved. You also built a 5V voltage regulator circuit to power the circuits so that S1XT33N can freely roam on the ground. Our end goal is to have S1XT33N be voice-controlled, and in order to do that, we need a way for S1XT33N to listen to what you're saying.\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Lab Notes\n",
    "* [Main Lab Note](https://eecs16b.org/lab/notes/lab_note4.pdf)\n",
    "* [Extra Note](https://eecs16b.org/lab/notes/lab_note4_extra.pdf)\n",
    "\n",
    "Review the lab note. The lab note provides a technical review of the concepts covered in lab as well as theoretical connections. **You should read the lab notes before your lab section.** They serve as a review and will be helpful as a reference during section.\n",
    "\n",
    "The extra lab note is optional reading for after you've completed the lab if you are interested in learning more about the electret microphone.\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Pre-Lab\n",
    "\n",
    "Complete the pre-lab assignment before doing the lab. Submit your answers to the Gradescope assignment \"[\\[Lab\\] Pre-Lab 4: Sensing Part 1](https://www.gradescope.com/courses/484565/assignments/2673318)\". Please make sure that you submit to the correct assignment. Pre-Lab 4 is due on **Sunday, February 26 at 11:59pm**. No late submissions will be accepted.\n",
    "\n",
    "## Help Request Form\n",
    "Use this [form](https://eecs16b.org/lab-help) to request help in your debugging / conceptual needs."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Project Breadboard Layout\n",
    "In this lab, you will be building S1XT33N's \"ears,\" the mic board circuit that will pick up your voice and convert it into an electrical signal. These circuits correspond to the regions in the center of the breadboard labelled Mic Board, Biasing Circuit, Op-Amp, and Low-Pass Filter. **Again, we strongly recommend that you follow this layout as you build the different circuits for S1XT33N.**\n",
    "<img width=\"700px\" src=\"images/suggested_layout.jpg\">\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<a id='part1'></a>\n",
    "# <span style=\"color:navy\">Part 1: Mic Board Circuitry</span>\n",
    "-----"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "The Mic Board is the primary component that converts your voice into an electrical signal; we will build peripheral circuitry so that the Mic Board functions properly. More information about the Mic Board can be found in the lab note.\n",
    "\n",
    "### 1.1. Setting up the Mic Board\n",
    "\n",
    "#### Materials\n",
    "- Mic board\n",
    "- Op-amp\n",
    "\n",
    "<img style=\"width:250px\" src=\"images/mic_annotated.png\">\n",
    "\n",
    "#### Tasks: \n",
    "\n",
    "1. Plug in an Op Amp into the 8-pin socket on your mic board. Make sure you **plug it in the right way** by matching the notch on the op amp chip with the notch in the op amp socket on the mic board! \n",
    "\n",
    "2. Plug your micboard _DIRECTLY_ into your project breadboard. **No jumper wires**\n",
    "\n",
    "3. Connect the mic board's `VDD` pin to 5V from the positive rails, powered by the 5V regulator.\n",
    "\n",
    "4. Connect either of the mic board's two `VSS` pins to the ground rail (you only need to connect one of them).\n",
    "\n",
    "The recommended layout of your project breadboard is reproduced below for your convenience. We suggest you put your mic board near the center of your project breadboard, as you will be building more circuits for the remainder of the lab.\n",
    "<img style=\"width:750px\" src=\"images/suggested_layout.jpg\">"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### 1.2. Build the Biasing Circuit\n",
    "\n",
    "The purpose of the biasing circuit is to produce a constant $2.5V$ output at the `HALF_RAIL`, which is used by the micboard. For more details on the purpose of the $2.5V$, refer to the lab note.\n",
    "\n",
    "#### Materials\n",
    "- Mic board\n",
    "- Additional Op-Amp (not the one on the micboard)\n",
    "- 2x $10 k\\Omega$ resistors | (code: brown, black, orange, gold)\n",
    "- $100 k\\Omega$ resistor | (code: brown, black, yellow, gold)\n",
    "- Power supply\n",
    "- Screwdriver\n",
    "\n",
    "|Biasing Circuit:|Op-Amp Pinout:|\n",
    "|:-----:|:---------------:|\n",
    "|<img style=\"width:500px\" src=\"images/sp23_biasing.png\">|<img style=\"width:500px\" src=\"images/op_amp_pinout.png\">| \n",
    "\n",
    "\n",
    "#### Tasks:\n",
    "\n",
    "1. Build the biasing circuit near your mic board on the project breadboard. Use the suggested layout from above as a reference for where we recommend you build the circuit.\n",
    "\n",
    "2. Connect any nodes requiring 5V to the positive rails on your project breadboard.\n",
    "\n",
    "3. Connect the node labeled `HALF_RAIL` to an empty row on your project breadboard.\n",
    "\n",
    "4. Connect `OS1` on your mic board to the `HALF_RAIL` using a $100k\\Omega$ resistor.\n",
    "\n",
    "5. Connect `OS2` on your mic board to the `HALF_RAIL` using a wire.\n",
    "\n",
    "6. Power your 5V regulator with 9V using the +25V channel on your DC power supply. Make sure to set the current limit to 0.1A!\n",
    "\n",
    "#### Sanity check:\n",
    "- Pause here and make sure that all of your nodes on the mic board are connected to the correct voltages:\n",
    "    - VDD = 5V\n",
    "    - VSS = 0V\n",
    "    - OS1 = ~2.5V\n",
    "    - OS2 = ~2.5V\n",
    "- If any node's voltage is not what you expect it to be, go back and debug your circuits!"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Questions\n",
    "\n",
    "<span style=\"color:#075a04\"> **1.2.1 What is the purpose of OS1 and OS2?** </span>\n",
    "\n",
    "_Hint: Read the lab note if you're not sure!_\n",
    "\n",
    "OS1 DC Offset: Because we need our signal to be centered in our target range (0 - 5 V), we will need to set the DC offset to the midpoint of this range: 2.5 V. This can easily be accomplished with a voltage divider of two equal resistors from\n",
    "the 5 V rail to ground.\n",
    "\n",
    "OS2: Level Shift\n",
    "When we introduce the DC Offset, we will encounter a problem when the signal passes through the non-inverting\n",
    "amplifier: that DC offset will be amplified along with the rest of the signal! This is because the amplifier will\n",
    "amplify the signal as referenced from ground. We connect OS2 to 2.5V when building the mic board circuits - this is how we tell the non-inverting amplifier to use 2.5V as a reference."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### 1.3. Tune Your Mic Board\n",
    "\n",
    "#### Materials:\n",
    "- Phone speaker or headphones\n",
    "\n",
    "#### Tasks:\n",
    "1. Connect your oscilloscope probe to $V_{out}$ on your mic board.\n",
    "\n",
    "2. Add a **peak-to-peak** measurement for the oscilloscope channel you're using to probe your mic board output. Additionally, we recommend you set the horizontal time scale to about 5-10 ms.\n",
    "\n",
    "3.  **Play a pure tone using a [tone generator](https://www.szynalski.com/tone-generator/) in the range (1500 - 2000 Hz)** on your phone at a reasonable volume (leaning towards the soft side). Do NOT use a Youtube video!\n",
    "    - If the tone generator website is not working for you, you can download a tone generator app onto your phone instead.\n",
    "\n",
    "4.  Make sure to point the speaker directly at the mic and hold it a few inches away from the mic. The distance between your speaker and the mic significantly affects the tuning process, so **try to keep the distance between your phone and speaker consistent**.\n",
    "\n",
    "5. Turn the potentiometer on the mic board **(CW: decrease amplitude | CCW: increase amplitude)** using a screwdriver until you see a sine wave with a **peak-to-peak of around 1.5V to 2V** on the oscilloscope. **The sine wave should be centered at around 2.5V.**\n",
    "    - **The potentiometer is a multiturn potentiometer, so you will have to turn it A LOT before you will notice any changes.** However, note that the tuning screw is very sensitive near the target voltage range.\n",
    "\n",
    "6. Verify that the frequency of the measured sine wave matches the tone from your phone using your oscilloscope by adding a **frequency** measurement.\n",
    "\n",
    "#### Important Notes:\n",
    "- With oscillating signals like this, there is an important concept called \"railing.\" We define railing, with regards to this mic board, as non-linear behavior at the boundaries of the output range that results from the op-amp on the mic board being limited by its VDD and VSS, rendering it unable to output the entire output range. If you see flat edges/lines on either the top or bottom of the waveform instead of the smooth peaks and troughs of the sine wave, which happens if you have $V_{pp} \\geq 5V$, your mic board is railing, and you need to reduce the amplitude of the mic board output.\n",
    "\n",
    "|Normal/Correct Behavior:|Railing Behavior (AVOID THIS):|\n",
    "|:-----------:|:-----------:|\n",
    "|<img style=\"width:500px\" src=\"images/not_railing.jpg\">|<img style=\"width:500px\" src=\"images/railing.jpg\">|\n",
    "\n",
    "- As a sanity check: Tap on the mic and ensure that it rails. However, **it should not be railing while you play the tone.**\n",
    "- **DO NOT use autoscale on the oscilloscope!** It will not work well with our mic board signal because the signal varies very rapidly. Using autoscale often sets the timescale to a few nanoseconds, which is too small of a timescale to see anything of importance or value for us.\n",
    "\n",
    "<span style=\"color:#ba190f\">**Congratulations! You have successfully tuned your mic board!**</span>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### 1.4. Measure the Frequency Response of the Speaker-Microphone System\n",
    "\n",
    "Now that we've built and tuned our mic board circuits, we now need to characterize the system and determine its frequency response: its performance at various different frequencies of sound.\n",
    "\n",
    "Usually this is performed with an automated linear sweep of every value within the range of frequencies that your system will be tasked with handling. As this is impractical to do manually, you will be testing and measuring values for a few key frequencies spread out across the entire range. \n",
    "\n",
    "Note that we are finding the frequency response of our joint speaker-microphone system, not just that of our microphone. You can think of our system as your speaker (which is playing the pure tones) in series with your microphone (which is receiving the pure tones) and outputting some voltage corresponding to those pure tones. We are measuring this cascaded system's reactions to certain frequency inputs.\n",
    "\n",
    "Use the oscilloscope to measure the peak-to-peak voltage of the mic board output ($V_{out}$) at each frequency in the dictionary `freq_Vpp` below. Record these values into this dictionary and run the code to plot the frequency response of your joint system.\n",
    "\n",
    "As a reminder, **keeping your phone/speaker at a fixed distance and volume from your mic board for all frequencies**. We recommend that you choose your speaker's volume in accordance with one of the middle frequencies and its corresponding oscilloscope reading. This is because most speakers are not expected to be audible for low frequencies. "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import scipy.signal as sp\n",
    "from pylab import * \n",
    "%matplotlib inline"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Vpp =  [0.5, 0.5, 1.5, 2.2, 4.2, 4.8, 5.0, 5.3, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5]\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "Text(0, 0.5, 'Gain (Volts/Volts)')"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Record the amplitude of the output sinusoid at each given frequency. \n",
    "# Fill in your values here and replace the \"None\"s with your measured voltage values\n",
    "freq_Vpp = {\n",
    "    100: 0.5,\n",
    "    200: 0.5, \n",
    "    300: 1.5, \n",
    "    500: 2.2, \n",
    "    800: 4.2, \n",
    "    1000: 4.8, \n",
    "    1250: 5.0, \n",
    "    1750: 5.3, \n",
    "    2000: 5.5,  \n",
    "    3000: 5.5, \n",
    "    4000: 5.5, \n",
    "    5000: 5.5, \n",
    "    6000: 5.5, \n",
    "    7000: 5.5, \n",
    "    8000: 5.5,\n",
    "    10000: 5.5,\n",
    "    15000: 5.5\n",
    "}\n",
    "freq = sorted(list(freq_Vpp.keys()))\n",
    "assert len(freq) == 17, \"Ensure that you didn't remove any of the frequences :pandacop:\"\n",
    "\n",
    "Vpp = [freq_Vpp[f] for f in freq] \n",
    "print(\"Vpp = \", Vpp)\n",
    "\n",
    "# We do not have a measurable input signal Vin, so we normalize the maximum of the frequency response to 1.\n",
    "gain = np.array(Vpp)/max(Vpp)\n",
    "\n",
    "plt.loglog(freq, gain)\n",
    "plt.title('log-Gain vs. log-Frequency')\n",
    "plt.xlabel('Frequency (Hz)')\n",
    "plt.ylabel('Gain (Volts/Volts)')\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Save your `freq_Vpp` dictionary somewhere (we recommend pasting it into a random Google Doc)! You will need it in the next lab and the lab report.\n",
    "\n",
    "<span style=\"color:#075a04\"> **1.4.1. What do you notice about the shape of this function? Which frequencies result in large output?**</span>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "It caps off around 5.5V bc of our range of VSS and VDD"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<span style=\"color:#075a04\"> **1.4.2. What would be the shape of an ideal speaker-microphone system's frequency response?**</span>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Smooth sine fucntion, no railing"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<span style=\"color:#075a04\"> **1.4.3. What does the plot tell you about the loudness of your speaker at certain frequencies? Does this reflect your experience listening to music?**</span>\n",
    "\n",
    "Hint: low frequencies correspond to the bass in a song. Try playing something [bass-heavy :)](https://youtu.be/rCuBBaLtXQQ)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "The higher the frequncy the higher the amplitude (more bass), and when we listen to music such as 432hz the bass seems much softer than a regular rap song for say."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<span style=\"color:#075a04\">**1.4.4. Let's say you wanted to flatten out the frequency response of your system such that the gain is around the same across all frequencies. Suggest a way to accomplish this with the circuit elements you learned about in lecture.**</span>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Set the power supply limit"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<a id='part2'></a>\n",
    "# <span style=\"color:navy\">Part 2: *Bass*ic Filter</span>\n",
    "\n",
    "-----\n",
    "In this part, you will build a low-pass filter to isolate the frequencies below the provided cutoff frequency. This filter will eventually be used to better sample voice commands in later phases of the project.\n",
    "\n",
    "### Materials\n",
    "- Capacitors\n",
    "- Resistors\n",
    "- LED\n",
    "- Function generator\n",
    "- Oscilloscope"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Tasks\n",
    "\n",
    "### 2.1. Design and Build the Low-Pass Filter\n",
    "\n",
    "1. Recall the circuit diagram and cutoff frequency equation $f_c$ for a first-order low pass RC filter. Feel free to refer to lecture notes or draw it out if it helps.\n",
    "\n",
    "2. Choose values for $R$ and $C$ such that your cutoff frequency $f_c$ is roughly 2500 Hz. Don't worry about getting the exact cutoff frequency: being within a few hundred Hz is fine.\n",
    "    - We chose 2500 Hz because most of the human vocal range falls below 2500 Hz.\n",
    "    \n",
    "3. Record your values for $R$ and $C$ in the code below. Write code to calculate $f_c$ given your values using the $R$ and $C$ variables.\n",
    "\n",
    "4. Build the low-pass filter on your breadboard. Don't connect the micboard output to your low pass filter yet!\n",
    "    - Look in the lab note for the resistor color code chart and capacitor code chart.\n",
    "    - Remember, you can combine resistors in series/parallel with each other!\n",
    "\n",
    "#### Notes/Tips:\n",
    "- Since we have far more resistor values than we have capacitor values, start by choosing an easy capacitor value, like $1\\mu F$, $0.1\\mu F$, etc. Pick one that lets you choose resistors of at least 1 $k\\Omega$ (otherwise, the current draw would make the readings unstable)."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "### YOUR CODE HERE\n",
    "R = 6.366 Kilo Ohms\n",
    "C = 10 nF = 10^-8 F (Filter)\n",
    "f_c = 2500\n",
    "\n",
    "print(\"Low pass filter\")\n",
    "print(\"===============\")\n",
    "print(\"Resistor: {} ohms\".format(R))\n",
    "print(\"Capacitor: {} farads\".format(C))\n",
    "print(\"Cutoff frequency: {} Hz\".format(f_c))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### 2.2. Test the Low-Pass Filter\n",
    "\n",
    "With the low pass filter built, we'll check that the cutoff frequency is as expected. To test it in isolation from other components, we'll use the function generator to generate a reliable input. \n",
    "\n",
    "1. Set your function generator to output a sinusoid with a 2.5V offset, 1V peak-to-peak voltage, and the frequency as the cutoff frequency of your low pass filter. Remember to set the output load to High-Z.\n",
    "2. Connect the function generator to the input of your low pass filter. **Make sure your mic board output is not connected to your filter**. \n",
    "3. Probe the output of your low pass with your oscilloscope. Ensure the gain/attentuation at the cutoff frequency is what you expect by comparing the peak-to-peak values of your input and output sinusoids. \n",
    "    - At the filter's cutoff frequency, the output $V_{pp}$ should be $\\frac{1}{\\sqrt 2} \\cdot V_{pp}$. \n",
    "4. Additionally try outputting a very low frequency and very high frequency, and see if the output changes as expected."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### 2.3. Plot the Frequency Response of the Low-Pass-Filtered Mic Board\n",
    "\n",
    "Now that we've verified the low-pass filter's functionality, it's time to connect it to our mic board. \n",
    "1. Disconnect your function generator from your circuit. Connect the **output of the mic board** to the input of your filter.\n",
    "2. Probe the output of your filter with your oscilloscope.\n",
    "\n",
    "Once you have done that, fill in the cutoff frequency of your low pass filter in the cell below and run it to plot the ideal frequency response of an RC low pass filter. "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "### TODO: Enter your low cutoff frequency below inside the float() call. \n",
    "low_cutoff = 2500 #TODO\n",
    "\n",
    "lp_p2p_expected = 1/(np.sqrt(1+((np.array(freq)/(low_cutoff))**2)))\n",
    "\n",
    "\n",
    "plt.plot(freq, lp_p2p_expected)\n",
    "plt.xlabel(\"Frequency (Hz)\")\n",
    "plt.ylabel(\"Output Voltage/Input Voltage\")\n",
    "plt.title(\"Frequency vs Gain (Low Pass)\")\n",
    "plt.show()\n",
    "\n",
    "plt.loglog(freq, lp_p2p_expected)\n",
    "plt.xlabel(\"Frequency (Hz)\")\n",
    "plt.ylabel(\"Output Voltage/Input Voltage\")\n",
    "plt.title(\"log-Frequency vs log-Gain (Low Pass)\")\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Next, we will measure the frequency response of the low-pass-filtered mic board. For the given frequencies below in `lp_freq_Vpp`,  measure and record the output peak-to-peak voltage values."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Record the amplitude of the output sinusoid at each given frequency. \n",
    "# Fill in your values here and replace the \"None\"s with your measured voltage values\n",
    "lp_freq_Vpp = {\n",
    "    200: 700mv,\n",
    "    400: 1.2V, \n",
    "    600: 2.0V, \n",
    "    1000: 3.7V, \n",
    "    2000: 5.0,\n",
    "    5000: 3.3V\n",
    "}\n",
    "lp_freqs = sorted(list(lp_freq_Vpp.keys()))\n",
    "lp_p2p_observed = [lp_freq_Vpp[f] for f in lp_freqs]\n",
    "\n",
    "lp_gain_observed = np.array(lp_p2p_observed)/np.max(lp_p2p_observed)\n",
    "\n",
    "plt.xlabel(\"Frequency (Hz)\")\n",
    "plt.ylabel(\"Output Voltage/Input Voltage\")\n",
    "plt.title(\"Frequency vs Gain (Low Pass)\")\n",
    "plt.plot(freq, lp_p2p_expected)\n",
    "plt.scatter(lp_freqs, lp_gain_observed)\n",
    "plt.show()\n",
    "\n",
    "plt.xlabel(\"Frequency (Hz)\")\n",
    "plt.ylabel(\"Output Voltage/Input Voltage\")\n",
    "plt.title(\"log-Frequency vs log-Gain (Low Pass)\")\n",
    "plt.loglog(freq, lp_p2p_expected)\n",
    "plt.scatter(lp_freqs, lp_gain_observed)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<!-- <span style=\"color:#075a04\"> **Sanity check: Does the frequency response of your low-pass filtered mic board match the frequency response of an ideal low-pass RC filter? Why or why not?** </span> -->\n",
    "\n",
    "<span style=\"color:#075a04\">  **Note: The frequency response of your low-pass filtered mic board won't match the frequency response of the ideal low-pass RC filter. Think about why this might be the case.** </span>\n",
    "\n",
    "\n",
    "Now, we will multiply the ideal low-pass filter frequency response (lp_p2p_expected) with our observed speaker-mic board frequency response (the variable called gain). Run the script below to plot the resulting frequency response."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "response_lp_micboard = np.multiply(lp_p2p_expected, gain)\n",
    "\n",
    "plt.xlabel(\"Frequency (Hz)\")\n",
    "plt.ylabel(\"Output Voltage/Input Voltage\")\n",
    "plt.title(\"Frequency vs Gain (Low pass filtered Micboard)\")\n",
    "plt.plot(freq, response_lp_micboard)\n",
    "plt.scatter(lp_freqs,lp_gain_observed)\n",
    "plt.show()\n",
    "\n",
    "plt.xlabel(\"Frequency (Hz)\")\n",
    "plt.ylabel(\"Output Voltage/Input Voltage\")\n",
    "plt.title(\"log-Frequency vs log-Gain (Low pass filtered Micboard)\")\n",
    "plt.loglog(freq, response_lp_micboard)\n",
    "plt.scatter(lp_freqs,lp_gain_observed)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<span style=\"color:#075a04\"> **Sanity check: Does the frequency response of your low-pass filtered mic board match the frequency response of the low-pass filter multiplied with our speaker-mic board frequency response? Why or why not?** </span>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### 2.4. Amplify the Low-Pass Signal\n",
    "After filtering, the signal may not be strong enough to be measured by the Arduino. Therefore, we may need to amplify the signal.\n",
    "\n",
    "1. Build a non-inverting amplifier as described in Appendix A of [Lab Note 1](https://eecs16b.org/lab/notes/lab_note1.pdf), where $v_{in}$, $V_{REF}$, and $v_{out}$ in the note correspond to `Vin`, `Vref`, and `Vout` in the diagram below. Make sure to use resistor values of $\\geq 1k \\Omega$. Choose a gain such that the largest peak-to-peak voltage in `lp_freq_Vpp` is amplified to around 2-2.5V.\n",
    "    - If your $V_{pp}$ is already high enough (which will likely be the case), you won't need any gain, so you can simply build a buffer.\n",
    "    - Since all of the signals are centered at half rail rather than 0V, we will treat 2.5V as our virtual ground. Note that `Vref` is connected to 2.5V rather than GND to preserve our 2.5V offset.\n",
    "2. Connect the output of your filter to the input of your amplifier.\n",
    "3. Connect the output of your amplifier to a 10 $\\Omega$ resistor and LED in series. This will help you visualize the output of your amplified Low Pass Signal.\n",
    "    - Note that the cathode of the LED is connected to the half rail, not ground!\n",
    "4. Probe the output of your amplifier to ensure your signal responds to noise and is not railing. \n",
    "    - Is the LED's behavior what you would expect? It's ok if the LED doesn't work perfectly, it tends to be a bit finicky.\n",
    "\n",
    "\n",
    "<img style=\"width:750px\" src=\"images/sp23_low_pass.png\">"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<a id='checkoff'></a>\n",
    "# <span style=\"color:#ba190f\">CHECKOFF</span>\n",
    "-----\n",
    "### Checkoff Form (https://eecs16b.org/lab-checkoff)\n",
    "\n",
    "- **Have all questions and plots completed in this notebook.**\n",
    "\n",
    "- **Show your TA your working circuits:**\n",
    "    - Show the output of your tuned mic board on the oscilloscope.\n",
    "    - Show your frequency response plot of the speaker-microphone system.\n",
    "\n",
    "- **Be prepared to answer conceptual questions about the lab.**\n",
    "    \n",
    "- <span style=\"color:red;font-weight:bold\">DO NOT DISMANTLE ANY CIRCUITS FROM YOUR BREADBOARD! You will need them for the rest of the project!</span>\n",
    "\n",
    "- **Remember what each part of your circuit is for. You will need to write summaries of each lab for the lab reports!**\n",
    "\n",
    "- **Back up this document (e.g. to Google Drive or Github).**\n",
    "\n",
    "- If you're interested in learning more about the components we used in this lab, read the [extra reading lab note](https://eecs16b.org/lab/notes/lab_note4_extra.pdf)."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<a id='part4'></a>\n",
    "# <span style=\"color:navy\">Part 4: Midterm Lab Report Questions</span>\n",
    "-----"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "The midterm lab report tests your understanding of EECS 16B Labs 1-5, with an emphasis on conceptual and\n",
    "analytical understanding. It also allows you to look at these labs from a bigger picture and reflect on your design\n",
    "process and choices. We will release the lab report questions relevant to each lab at the bottom of the corresponding Jupyter notebook. All of the midterm lab report questions will be compiled together [here](https://edstem.org/us/courses/34924/discussion/2428391) and updated as new questions are released. The entire midterm lab report will be due on **Friday, 03/10**."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Questions\n",
    "\n",
    "**Summary**\n",
    "\n",
    "- Give a summary in your own words of what you did in this lab.\n",
    "\n",
    "The following questions will analyze the combined mic board and biasing circuit, which is shown below. The microphone  can be modeled as a signal-dependent current source, $I_{MIC} = k \\sin(\\omega t) + i_{drift}$, where $I_{MIC}$ is the current flowing from VDD to VSS, $k$ is the force to current conversion ratio, $\\omega$ is the signal's frequency (in \\si{\\radian\\per\\second}), and $i_{drift}$ is a constant current offset (in A). Note that $R_{51}$ and $R_{52}$ are resistors of the potentiometer ($R_5 = R_{51} + R_{52}$).\n",
    "\n",
    "When asked to give an answer in terms of the circuit components, please give your answer only in terms of $V_{DD}$, $R_1$, $R_3$, $R_4$, $R_{51}$, $R_{52}$, $k$, $\\omega$, $t$, $i_{drift}$, and/or standard mathematical constants and functions. Throughout this problem, please show all of your work.\n",
    "\n",
    "<img style=\"width:500px\" src=\"images/mic_and_biasing.png\">\n",
    "\n",
    "**1. What is the voltage $V_1$ in terms of the circuit components?**\n",
    "\n",
    "**2. What is the voltage $V_2$ in terms of $V_1$? What is the voltage $V_2$ in terms of the circuit components? Assume that $R_2=0$.**\n",
    "\n",
    "**3. What is the voltage $V_4$ in terms of the circuit components?**\n",
    "\n",
    "**4. What is the voltage $V_3$ in terms of $V_2$ and $V_4$? What is the voltage $V_3$ in terms of the circuit components? Assume that $C_1$ and $R_6$ are large enough such that only AC signals pass through $C_1$.**\n",
    "\n",
    "**5. What is $V_{OUT}$ in terms of $V_3$ and $V_4$? What is $V_{OUT}$ in terms of the circuit components?**\n",
    "\n",
    "**6. Did your mic board performance seem to deviate from your model? Why/why not? Please include a graph of your micboard transfer function with your answer.**"
   ]
  }
 ],
 "metadata": {
  "anaconda-cloud": {},
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.9.9"
  },
  "vscode": {
   "interpreter": {
    "hash": "aee8b7b246df8f9039afb4144a1f6fd8d2ca17a180786b69acc140d282b71a49"
   }
  }
 },
 "nbformat": 4,
 "nbformat_minor": 1
}
